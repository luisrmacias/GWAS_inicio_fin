estudio=fusion_agosto2018
lista_sexos=/export/home/lmacias/analisis_asociacion/adultos_mega/listas/integrar_sexos_cero.txt
plink --vcf $estudio.genoref.vcf.gz --const-fid --update-sex <(awk '$3!=0, $1=0 ""' $lista_sexos | sort -u) --make-bed --out $estudio

##agregamos fenotipo y sexo
awk -i inplace '$2~/GC/ || $2~/ICN/ {$6=1} 1' $estudio.fam
awk -i inplace '$2~/SOL/ || $2~/RED/ || $2~/CON/ || $2~/TER/ || $2~/MZ1/ {$6=2} 1' $estudio.fam

cut -f2 -d " " $lista_sexos
plink --bfile $estudio  --make-bed --out $estudio
plink --bfile fusionados_GEA --geno 0.05 --make-bed --out fusionados_GEA.QC
plink --bfile fusionados_GEA.QC --maf 0.05 --hwe 1e-5 --make-bed --out fusionados_GEA.QC
ls *~
rm *~
##verificamos duplicados y parentezco
plink --bfile fusionados_GEA.QC --genome --out fusionados_GEA.QC
sort -grk10 fusionados_GEA.QC.genome | less

plink --bfile fusionados_GEA.QC --check-sex --out fusionados_GEA.QC
##se elimina un individuo adicional


##de acuerdo a verificación de sexo hecho en etapa anterior de detectan inversiones de identificadores. GC927 y GC926 invertidos. Se cambian estos identificadores
grep -e 927 -e 926 fusionados_GEA.QC.fam | grep GC | cut -f 1,2 -d " " > listas/cambio_ids_invertidos.txt
vim listas/cambio_ids_invertidos.txt
plink --bfile fusionados_GEA.QC --update-ids listas/cambio_ids_invertidos.txt --make-bed --out fusionados_GEA.QC

##tras la corrección de sexo de un individuo y las inversiones anteriores restan 5 individuos a eliminar
vim ../listas/eliminacion_QC/noconcuerdasexo.txt
##guardamos en listas/elim_sexo.txt
vim ../listas/eliminacion_QC/noconcuerdasexo.txt
plink --bfile fusionados_GEA.QC --remove listas/elim_sexo.txt --make-bed --out fusionados_GEA.QC
##repetimos genome y quedó muy bien

##regresamos de cálculo ancestría y componentes
sort -grk10 ancestria/ancestrales_GEA.genome | grep -e GC -e GP | tail -n +6 | head -23 | tr -s [:blank:] "\t" | cut -f2,3 > listas/eliminacion_QC/familiares.txt 


p-link --noweb --bfile imputados/fusionados_GEA.QC --loop-assoc listas/grupos/por_centrogeno.txt --pfilter 1e-9 --out listas/eliminacion_QC/dif_porlote
p-link --noweb --bfile imputados/fusionados_GEA.QC --loop-assoc listas/grupos/por_centrogeno.txt --pfilter 1e-9 --filter-controls --out listas/eliminacion_QC/dif_porlote_controles

cat listas/eliminacion_QC/dif_porlote_controles.[1-4]* | tr -s [:blank:] "\t" | cut -f 3 | sort -u > listas/SNPS/difieren_porcentro.txt

