cd /export/home/lmacias/analisis_asociacion/adultos_mega/cirugia_bar/imputados/fusionados
estudio=fusion_agosto2018
lista_sexos=/export/home/lmacias/analisis_asociacion/adultos_mega/listas/integrar_sexos_cero.txt
plink --vcf $estudio_genoref.vcf.gz --const-fid --update-sex <(awk '$3!=0, $1=0 ""' $lista_sexos | sort -u) --make-bed --out $estudio

##agregamos fenotipo y sexo
awk -i inplace '$2~/GC/ || $2~/ICN/ {$6=1} 1' $estudio.fam
awk -i inplace '$2~/SOL/ || $2~/RED/ || $2~/CON/ || $2~/TER/ || $2~/MZ1/ {$6=2} 1' $estudio.fam

cut -f2 -d " " $lista_sexos
plink --bfile $estudio --geno 0.05 --make-bed --out $estudio.QC
plink --bfile $estudio.QC --freq --hardy --out $estudio.QC
plink --bfile $estudio.QC --maf 0.025 --hwe 1e-5 --make-bed --out $estudio.QC
ls *~
rm *~
##verificamos duplicados y parentezco
plink --bfile $estudio.QC --genome --out $estudio.QC
sort -grk10 $estudio.QC.genome | less
awk '$10>0.9' $estudio.QC.genome 
#seguimos con 9 duplicados, 6 de ellos con misma clave. En cuanto a los 3 con clave distinta, eliminamos el par excepto 115 y 384, mismo individuo.
##DEJAMOS PENDIENTE ELECCIÓN ENTRE ELIMINAR RL115 y RL_384. Dependerá de datos de secuenciación.
cat <(awk '$10>0.9 {print $1,$2}' $estudio.QC.genome | grep -v 384) <(awk '$10>0.9 {print $3,$4}' $estudio.QC.genome | tail -n2) >> ~/analisis_asociacion/adultos_mega/listas/eliminacion_QC/conjunto_eliminar.txt
plink --bfile $estudio.QC --remove ~/analisis_asociacion/adultos_mega/listas/eliminacion_QC/conjunto_eliminar.txt --make-bed --out $estudio.QC
ls *~
rm *~

plink --bfile $estudio.QC --check-sex --out $estudio.QC 
##se elimina un individuo adicional
grep PROBLEM $estudio.QC.sexcheck | awk '$3!=0 && $4!=0 {print $1,$2}' >> ~/analisis_asociacion/adultos_mega/listas/eliminacion_QC/conjunto_eliminar.txt
plink --bfile $estudio.QC --remove ~/analisis_asociacion/adultos_mega/listas/eliminacion_QC/conjunto_eliminar.txt --make-bed --out $estudio.QC
ls *~
rm *~

